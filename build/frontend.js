(()=>{"use strict";class t{constructor(t,e,r){Array.from(document.querySelectorAll(t)).forEach((t=>{null!=t.type&&"file"==t.type?t.addEventListener("change",(t=>{let s=t.target.files[0];if(null!=s&&FileReader){const t=new FileReader;t.addEventListener("load",(t=>{var s=new Image;s.src=t.target.result,s.addEventListener("load",(t=>this.createOverlay(t.target,e,r)))})),t.readAsDataURL(s)}})):t.addEventListener("click",(t=>t.target.addEventListener("load",this.createOverlay(t.target,e,r))))})),window.addEventListener("resize",(t=>this.adjustApp(t))),window.addEventListener("keydown",(t=>this.onKeyStroke(t)))}createOverlay(t,e,r){let s=null!=e&&null!=e.imageType&&"jpeg"==e.imageType?e.imageType:"png",o=null!=e&&null!=e.imageQuality?e.imageQuality:"1",a=document.createElement("style");a.id="ctc-scroll-css",a.innerHTML="body{ overflow:hidden;margin:0;} ::-webkit-scrollbar-track {background: rgba(255, 255, 255, 1);} ::-moz-scrollbar-track { background: rgba(255, 255, 255, 1);} #js-crop-toolbar::-webkit-scrollbar {display: none;} #js-crop-toolbar::-moz-scrollbar {display: none;}",document.querySelector("head").appendChild(a),window.scrollTo(0,0);let i=document.createElement("div"),l=null!=e&&null!=e.customColor&&null!=e.customColor.overlayBgColor?e.customColor.overlayBgColor:"rgba(0,0,0,1)";i.id="js-crop-overlay",i.setAttribute("draggable",!1),i.style=`user-select: none;top:0%;left:0%;right:0%;bottom:0%;height:${window.innerHeight}px;width:${window.innerWidth}px;background-color:${l};z-index:100000;`,document.body.insertBefore(i,document.body.firstChild);let n=new Image;n.src=t.src;let d=n.height,u=n.width,p=document.querySelector("#js-crop-overlay"),c=this.getOptimizedImageSize(p.offsetWidth,p.offsetHeight,u,d),g=`border: 0.5px dotted rgba(255,255,255,1);display:inline-block;margin:${(p.offsetHeight-c.height)/2}px ${(.97*p.offsetWidth-c.width)/2}px;vertical-align:top;`;n.id="js-crop-image",n.style=g,n.height=c.height,n.width=c.width,n.setAttribute("data-img-type",s),n.setAttribute("data-img-quality",o),n.setAttribute("data-crop-status","in-active"),n.setAttribute("data-crop-step","0"),n.setAttribute("data-crop-0",n.src),n.setAttribute("data-crop-count","0"),n.setAttribute("draggable",!1),n.setAttribute("data-dim-ratio",`${u/c.width},${d/c.height}`),p.appendChild(n);let h=document.createElement("span");h.id="js-crop-close-btn",h.title="Close",h.innerHTML="&#10539;",h.addEventListener("click",(()=>this.closeOverlay())),h.style=`cursor:pointer;position:absolute;left:3px;font-size:${.016*document.querySelector("#js-crop-overlay").offsetWidth}px;color:rgba(255,255,255,1);text-shadow:-1px -1px 1px rgba(0,0,0,1);`,p.appendChild(h),this.createToolbar(p,n.src,{height:c.height,width:c.width,dimRatio:`${u/c.width},${d/c.height}`},e,r)}adjustApp(t){let e=document.querySelector("#js-crop-overlay");if(null!=e){let t=document.querySelector("#js-crop-image"),r=document.querySelector("#js-crop-toolbar");e.style.height=`${window.innerHeight}px`,e.style.width=`${window.innerWidth}px`;let s=Array.from(r.querySelectorAll("div"));r.style.height=e.offsetHeight+"px",r.style.paddingTop=(e.offsetHeight-s.length*r.offsetWidth)/2+"px";let o=new Image;o.src=t.src;let a=this.getOptimizedImageSize(e.offsetWidth,e.offsetHeight,o.width,o.height);t.height=a.height,t.width=a.width,t.style.margin=`${(e.offsetHeight-a.height)/2}px ${(.97*e.offsetWidth-a.width)/2}px`,s.map((t=>{t.style.height=t.offsetWidth+"px",t.style.fontSize=.8*t.offsetWidth+"px"})),document.querySelector("#js-crop-close-btn").style.fontSize=.45*r.offsetWidth+"px",null!=document.querySelector("#cropRect")&&(document.querySelector("#js-crop-overlay").removeChild(document.querySelector("#js-crop-overlay").querySelector("#cropRect")),document.querySelector("#start-crop").innerHTML="&#8862;",document.querySelector("#start-crop").title="Select area",document.querySelector("#js-crop-image").setAttribute("data-crop-status","in-active"),document.querySelector("#js-crop-image").removeAttribute("data-start-co"))}}createToolbar(t,e,r,s,o){let a=null!=s&&null!=s.imageType&&"jpeg"==s.imageType?s.imageType:"png",i=document.createElement("div"),l=null!=s&&null!=s.customColor&&null!=s.customColor.toolbarBgColor?s.customColor.toolbarBgColor:"rgba(255,255,255,1)";i.id="js-crop-toolbar",i.style=`tex-align:center;padding:2px;color:rgba(255,255,255,1);display:inline-block;width:3%;height:${t.offsetHeight}px;position:absolute;float:right;right:0;background-color:${l};overflow-y:auto;`,t.appendChild(i);let n=null!=s&&null!=s.customColor&&null!=s.customColor.buttonFontColor?s.customColor.buttonFontColor:"rgba(255,255,255,1)",d=null!=s&&null!=s.customColor&&null!=s.customColor.buttonBgColor?s.customColor.buttonBgColor:"rgba(0,0,0,1)",u=`color:${n};opacity:0;font-size:300%;cursor:pointer;border-radius:0%;margin-bottom:3px;background-color:${d};text-align:center;width:98%;height:${i.offsetWidth-6}px;border:1px solid ${d};box-shadow:-1px -1px 10px ${d};`,p=document.createElement("div");p.id="start-crop",p.title="Select area",p.style=u,p.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),p.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),p.innerHTML="&#8862;",p.addEventListener("click",(()=>this.addCropEventListener(event))),i.appendChild(p);let c=document.createElement("div");c.id="revert-to-original",c.title="Revert to original Image",c.setAttribute("data-img-dimension",r.height+","+r.width),c.setAttribute("data-dim-ratio",r.dimRatio),c.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),c.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),c.style=u+"line-height:1.3;",c.innerHTML="&#8646;",c.addEventListener("click",(t=>this.revertToOriginal(t))),i.appendChild(c);let g=document.createElement("div");g.id="previous-step",g.title="Revert to previous crop",g.style=u+"line-height:1.4;",g.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),g.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),g.innerHTML="&#10550;",g.addEventListener("click",(t=>this.restorePreviousCrop(t))),i.appendChild(g);let h=document.createElement("div");if(h.id="next-step",h.title="Restore last crop",h.style=u+"line-height:1.4;",h.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),h.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),h.innerHTML="&#10551;",h.addEventListener("click",(t=>this.restoreNextCrop(t))),i.appendChild(h),null!=s&&0!==s.length){if(!1!==s.saveButton){let t=document.createElement("div");t.id="save-image",t.title="Save Image",t.style=u+"line-height:1;",t.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),t.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),t.innerHTML="&#10515;",t.addEventListener("click",(()=>{let t=document.createElement("a");t.href=this.currentImgToBlob(),t.setAttribute("download","image."+a),t.click()})),i.appendChild(t)}if(null!=s.extButton&&0!==s.extButton.length&&"function"==typeof s.extButton.callBack){let t=document.createElement("div");t.id="ext-button",t.style=null!=s.extButton.buttonCSS?u+s.extButton.buttonCSS:u,t.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),t.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),t.title=s.extButton.buttonTitle?s.extButton.buttonTitle:"Extension",t.innerHTML=s.extButton.buttonText?s.extButton.buttonText:"ext",t.addEventListener("click",(()=>s.extButton.callBack(this.currentImgToBlob()))),i.appendChild(t)}}else{let t=document.createElement("div");t.id="save-image",t.title="Save Image",t.style=u+"line-height:1;",t.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),t.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="25%"})),t.innerHTML="&#10515;",t.addEventListener("click",(()=>{let t=document.createElement("a");t.href=this.currentImgToBlob(),t.setAttribute("download","image."+a),t.click()})),i.appendChild(t)}null!=o&&0!==o.length&&o.map(((t,e)=>{let r=null!=t.buttonEvent?t.buttonEvent:"click",s=document.createElement("div");s.id=`ext-button-${e}`,s.style=null!=t.buttonCSS?u+t.buttonCSS:u,s.addEventListener("mouseenter",(t=>{t.target.style.boxShadow=`-2px -2px 10px ${d}`,t.target.style.borderRadius="20%"})),s.addEventListener("mouseleave",(t=>{t.target.style.boxShadow=`-1px -1px 1px ${d}`,t.target.style.borderRadius="25%"})),s.title=t.buttonTitle?t.buttonTitle:`Button ${e+1}`,s.innerHTML=t.buttonText?t.buttonText:"ext","function"==typeof t.callBack&&s.addEventListener(r,(()=>t.callBack(this.currentImgToBlob(),t.relParam))),i.appendChild(s)}));let m=document.querySelector("#js-crop-toolbar"),y=Array.from(m.querySelectorAll("div"));m.style.paddingTop=(t.offsetHeight-y.length*m.offsetWidth)/2+"px",y.map(((t,e)=>{setTimeout((()=>{t.style.height=t.offsetWidth+"px",t.style.opacity="1",t.style.boxShadow=`-1px -1px 1px ${d}`,t.style.fontSize=.8*t.offsetWidth+"px",t.style.borderRadius="25%",t.addEventListener("click",(t=>{0!==e&&(null!=document.querySelector("#cropRect")&&document.querySelector("#js-crop-overlay").removeChild(document.querySelector("#js-crop-overlay").querySelector("#cropRect")),document.querySelector("#start-crop").innerHTML="&#8862;",document.querySelector("#start-crop").title="Select area",document.querySelector("#js-crop-image").setAttribute("data-crop-status","in-active"),document.querySelector("#js-crop-image").style.cursor="",document.querySelector("#js-crop-image").removeAttribute("data-start-co"))}))}),5*e)}))}addCropEventListener(t){let e=document.querySelector("#js-crop-image");e.setAttribute("data-mouse-status","up"),"in-active"===e.getAttribute("data-crop-status")?(e.style.cursor="crosshair",e.setAttribute("data-crop-status","active"),e.addEventListener("mousedown",(t=>{let e=document.querySelector("#cropRect");null!=e&&e.remove(),t.target.setAttribute("data-start-co",`${t.offsetX},${t.offsetY}`),t.target.setAttribute("data-mouse-status","down"),t.target.addEventListener("mousemove",(t=>{this.createCropBox(t)}))})),t.target.innerHTML="&#9986;",t.target.title="Crop"):"crop-ready"===e.getAttribute("data-crop-status")&&(this.endCrop(),t.target.innerHTML="&#8862;",t.target.title="Select area",e.setAttribute("data-crop-status","in-active")),document.querySelector("#js-crop-overlay").addEventListener("mouseup",(t=>{"start-crop"!=t.target.id&&"in-active"!=e.getAttribute("data-crop-status")&&(e.setAttribute("data-crop-status","crop-ready"),e.setAttribute("data-mouse-status","up"))}))}revertToOriginal(t){let e=document.querySelector("#js-crop-overlay"),r=document.querySelector("#js-crop-image"),s=parseInt(r.getAttribute("data-crop-count")),o=new Image;o.src=r.getAttribute("data-crop-0"),r.setAttribute("data-crop-count","0"),r.setAttribute("data-crop-step","0");for(let t=1;t<=s;t++)r.removeAttribute("data-crop-"+t);let a=this.getOptimizedImageSize(e.offsetWidth,e.offsetHeight,o.width,o.height);r.style.margin=`${(e.offsetHeight-a.height)/2}px ${(.97*e.offsetWidth-a.width)/2}px`,r.height=a.height,r.width=a.width,r.setAttribute("data-crop-status","in-active"),r.removeAttribute("data-mouse-status"),r.setAttribute("data-dim-ratio",t.target.getAttribute("data-dim-ratio")),r.src=r.getAttribute("data-crop-0")}restorePreviousCrop(t){let e=document.querySelector("#js-crop-image"),r=parseInt(e.getAttribute("data-crop-step"));if(1<r){let t=document.querySelector("#js-crop-overlay"),s=new Image;s.src=e.getAttribute("data-crop-"+(r-1)),s.addEventListener("load",(()=>{let o=this.getOptimizedImageSize(t.offsetWidth,t.offsetHeight,s.width,s.height);e.setAttribute("data-crop-step",r-1),e.style.margin=`${(t.offsetHeight-o.height)/2}px ${(.97*t.offsetWidth-o.width)/2}px`,e.height=o.height,e.width=o.width,e.src=s.src}))}}restoreNextCrop(t){let e=document.querySelector("#js-crop-image"),r=parseInt(e.getAttribute("data-crop-step")),s=parseInt(e.getAttribute("data-crop-count"));if(0<r&&s>=r+1){let t=document.querySelector("#js-crop-overlay"),s=new Image;s.src=e.getAttribute("data-crop-"+(r+1)),s.addEventListener("load",(()=>{let o=this.getOptimizedImageSize(t.offsetWidth,t.offsetHeight,s.width,s.height);e.setAttribute("data-crop-step",r+1),e.style.margin=`${(t.offsetHeight-o.height)/2}px ${(.97*t.offsetWidth-o.width)/2}px`,e.height=o.height,e.width=o.width,e.src=s.src,console.log(e.style.margin)}))}}currentImgToBlob(){let t=document.querySelector("#js-crop-image"),e=t.getAttribute("data-dim-ratio").split(","),r=`image/${t.getAttribute("data-img-type")}`,s=parseFloat(t.getAttribute("data-img-quality")),o=document.createElement("canvas"),a=(document.createElement("a"),o.getContext("2d")),i=parseFloat(e[1]),l=parseFloat(e[0]);return o.height=t.height,o.width=t.width,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(t,0,0,t.offsetWidth*l,t.offsetHeight*i,0,0,t.offsetWidth,t.offsetHeight),o.toDataURL(r,s)}closeOverlay(){document.body.removeChild(document.querySelector("#js-crop-overlay")),document.body.style.overflow="",document.body.style.margin="",document.querySelector("head").removeChild(document.querySelector("#ctc-scroll-css"))}endCrop(){let t=document.querySelector("#cropRect");if(null!=t){let e=t.getAttribute("data-start-xy").split(","),r=document.querySelector("#js-crop-image"),s=parseInt(r.getAttribute("data-crop-step"))+1,o=parseInt(r.getAttribute("data-crop-count")),a=r.getAttribute("data-dim-ratio").split(","),i=document.querySelector("#js-crop-overlay"),l=parseFloat(r.getAttribute("data-img-quality")),n=`'image/${r.getAttribute("data-img-type")}`,d=document.createElement("canvas"),u=d.getContext("2d"),p=parseFloat(a[1]),c=parseFloat(a[0]),g=t.offsetWidth*c,h=t.offsetHeight*p;r.style.margin=`${(i.offsetHeight-t.offsetHeight)/2}px ${(.97*i.offsetWidth-t.offsetWidth)/2}px`,r.style.cursor="",d.height=t.offsetHeight,d.width=t.offsetWidth,r.setAttribute("data-dim-ratio","1,1"),r.height=t.offsetHeight,r.width=t.offsetWidth,u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(r,parseInt(e[0])*c,parseInt(e[1])*p,g,h,0,0,t.offsetWidth,t.offsetHeight);let m=d.toDataURL(n,l);r.setAttribute("data-crop-step",s),r.setAttribute("data-crop-"+s,m),r.setAttribute("data-crop-count",s),r.src=m,r.removeAttribute("data-start-co"),i.removeChild(t);for(let t=s+1;t<=o;t++)r.removeAttribute("data-crop-"+t)}}createCropBox(t){let e=document.querySelector("#js-crop-image");if("in-active"!=e.getAttribute("data-crop-status")&&"down"==e.getAttribute("data-mouse-status")){let r=this.setCanvasCo(t);if(null!=r){let s=document.querySelector("#cropRect");null==s?(s=document.createElement("div"),s.setAttribute("draggable",!1),s.id="cropRect",s.style=`z-index:1001000;cursor:crosshair;position:absolute;border:1px dashed rgba(255,255,255,1);box-shadow:0px 0px 10px rgba(0,0,0,1);left:${parseFloat(e.style.marginLeft)+r.startX}px;top:${parseFloat(e.style.marginTop)+r.startY}px;width:${r.width}px;height:${r.height}px;`,s.addEventListener("dragover",(t=>t.preventDefault())),s.setAttribute("data-start-xy",r.startX+","+r.startY),e.parentNode.insertBefore(s,e),s.addEventListener("mousedown",(()=>e.setAttribute("data-mouse-status","down"))),s.addEventListener("mouseup",(()=>e.setAttribute("data-mouse-status","up"))),this.addResizeBoxes(s,{width:s.offsetWidth,height:s.offsetHeight},t,e),s.addEventListener("mousemove",(t=>{"down"==e.getAttribute("data-mouse-status")&&this.addResizeBoxes(s,{width:s.offsetWidth,height:s.offsetHeight},t,e)}))):"down"==e.getAttribute("data-mouse-status")&&null==s.getAttribute("data-resize")&&(s.style.left=parseFloat(e.style.marginLeft)+r.startX+"px",s.style.top=parseFloat(e.style.marginTop)+r.startY+"px",s.style.height=r.height+"px",s.style.width=r.width+"px",s.setAttribute("data-start-xy",r.startX+","+r.startY),this.addResizeBoxes(s,r,t,e))}}}addResizeBoxes(t,e,r,s){let o="background-color :rgba(0,0,0,0.7);width:10px;height:10px;border:1px solid rgba(255,255,255,255);";if(0===t.querySelectorAll("span").length){let r=document.createElement("span");r.style=o+"cursor:nwse-resize;margin-left:-6px;margin-top:-6px;position:absolute;position:absolute;",r.id="nwse-resize-one",r.setAttribute("draggable",!1),r.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","nwse-resize-one")})),r.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(r);let a=document.createElement("span");a.style=o+`cursor:ns-resize;margin-left:${e.width/2}px; margin-top: -7px; position:absolute;`,a.id="ns-resize-one",a.setAttribute("draggable",!1),a.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","ns-resize-one")})),a.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(a);let i=document.createElement("span");i.style=o+`cursor:nesw-resize;margin-left:${e.width-6}px; margin-top: -6px; position:absolute;`,i.id="nesw-resize-one",i.setAttribute("draggable",!1),i.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","nesw-resize-one")})),i.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(i);let l=document.createElement("span");l.style=o+`cursor:ew-resize;margin-left:${e.width-7}px; margin-top: ${e.height/2-7}px; position:absolute;`,l.id="ew-resize-one",l.setAttribute("draggable",!1),l.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","ew-resize-one")})),l.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(l);let n=document.createElement("span");n.style=o+`cursor:nwse-resize;margin-left:${e.width-6}px; margin-top: ${e.height-6}px; position:absolute;`,n.id="nwse-resize-two",n.setAttribute("draggable",!1),n.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","nwse-resize-two")})),n.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(n);let d=document.createElement("span");d.style=o+`cursor:ns-resize;margin-left:${e.width/2-6}px; margin-top: ${e.height-7}px; position:absolute;`,d.id="ns-resize-two",d.setAttribute("draggable",!1),d.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","ns-resize-two")})),d.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(d);let u=document.createElement("span");u.style=o+`cursor:nesw-resize;margin-left:-7px; margin-top:${e.height-7}px;position:absolute;`,u.id="nesw-resize-two",u.setAttribute("draggable",!1),u.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","nesw-resize-two")})),u.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(u);let p=document.createElement("span");p.style=o+`cursor:ew-resize;margin-left:-6px; margin-top: ${e.height/2-6}px; position:absolute;`,p.id="ew-resize-two",p.setAttribute("draggable",!1),p.addEventListener("mousedown",(()=>{t.setAttribute("data-prev-mousepos",""),s.setAttribute("data-mouse-status","up"),t.setAttribute("data-resize","ew-resize-two")})),p.addEventListener("mouseup",(()=>t.setAttribute("data-resize",""))),t.appendChild(p)}else if(null==t.getAttribute("data-resize"))t.querySelector("#nwse-resize-one").style=o+"cursor:nwse-resize;margin-left:-6px;margin-top:-6px;position:absolute;",t.querySelector("#ns-resize-one").style=o+`cursor:ns-resize;margin-left:${e.width/2-6}px; margin-top: -7px; position:absolute;`,t.querySelector("#nesw-resize-one").style=o+`cursor:nesw-resize;margin-left:${e.width-6}px; margin-top: -6px;position:absolute; `,t.querySelector("#ew-resize-one").style=o+`cursor:ew-resize;margin-left:${e.width-7}px; margin-top: ${e.height/2-7}px;position:absolute;`,t.querySelector("#nwse-resize-two").style=o+`cursor:nwse-resize;margin-left:${e.width-7}px; margin-top: ${e.height-7}px;position:absolute; `,t.querySelector("#ns-resize-two").style=o+`cursor:ns-resize;margin-left:${e.width/2-6}px; margin-top: ${e.height-7}px;position:absolute; `,t.querySelector("#nesw-resize-two").style=o+`cursor:nesw-resize;margin-left:-7px; margin-top:${e.height-7}px;position:absolute;`,t.querySelector("#ew-resize-two").style=o+`cursor:ew-resize;margin-left:-6px; margin-top: ${e.height/2-6}px; position:absolute;`;else{let e=s.getBoundingClientRect(),a=t.getBoundingClientRect();if("cropRect"!=r.target.id&&e.x<=r.clientX&&e.y<=r.clientY&&e.x+e.width>=r.clientX&&e.y+e.height>=r.clientY){if(null!=t.getAttribute("data-prev-mousepos")){let e=t.getAttribute("data-prev-mousepos").split("-"),s=Math.abs(parseInt(e[0])-r.clientX),o=Math.abs(parseInt(e[1])-r.clientY);switch(t.getAttribute("data-resize")){case"nwse-resize-one":a.x>r.clientX&&a.y>r.clientY?(t.style.top=parseInt(t.style.top)-o+"px",t.style.left=parseInt(t.style.left)-s+"px",t.style.height=parseInt(t.style.height)+o+"px",t.style.width=parseInt(t.style.width)+s+"px"):(t.style.top=parseInt(t.style.top)+o+"px",t.style.left=parseInt(t.style.left)+s+"px",t.style.height=parseInt(t.style.height)-o+"px",t.style.width=parseInt(t.style.width)-s+"px");break;case"ns-resize-one":a.y>r.clientY?(t.style.top=parseInt(t.style.top)-o+"px",t.style.height=parseInt(t.style.height)+o+"px"):(t.style.top=parseInt(t.style.top)+o+"px",t.style.height=parseInt(t.style.height)-o+"px");break;case"nesw-resize-one":a.y>r.clientY?(t.style.top=parseInt(t.style.top)-o+"px",t.style.height=parseInt(t.style.height)+o+"px",t.style.width=parseInt(t.style.width)+s+"px"):(t.style.top=parseInt(t.style.top)+o+"px",t.style.height=parseInt(t.style.height)-o+"px",t.style.width=parseInt(t.style.width)-s+"px");break;case"ew-resize-one":a.x+parseInt(a.width)<r.clientX?t.style.width=parseInt(t.style.width)+s+"px":t.style.width=parseInt(t.style.width)-s+"px";break;case"nwse-resize-two":a.x+parseInt(a.width)<r.clientX?(t.style.height=parseInt(t.style.height)+o+"px",t.style.width=parseInt(t.style.width)+s+"px"):(t.style.height=parseInt(t.style.height)-o+"px",t.style.width=parseInt(t.style.width)-s+"px");break;case"ns-resize-two":a.y+parseInt(a.height)<r.clientY?t.style.height=parseInt(t.style.height)+o+"px":t.style.height=parseInt(t.style.height)-o+"px";break;case"nesw-resize-two":a.y+parseInt(a.height)<r.clientY?(t.style.left=parseInt(t.style.left)-s+"px",t.style.height=parseInt(t.style.height)+o+"px",t.style.width=parseInt(t.style.width)+s+"px"):(t.style.left=parseInt(t.style.left)+s+"px",t.style.height=parseInt(t.style.height)-o+"px",t.style.width=parseInt(t.style.width)-s+"px");break;case"ew-resize-two":a.x>r.clientX?(t.style.left=parseInt(t.style.left)-s+"px",t.style.width=parseInt(t.style.width)+s+"px"):(t.style.left=parseInt(t.style.left)+s+"px",t.style.width=parseInt(t.style.width)-s+"px")}}t.setAttribute("data-start-xy",a.x-e.x+","+(a.y-e.y)),t.querySelector("#nwse-resize-one").style=o+"cursor:nwse-resize;margin-left:-6px;margin-top:-6px;position:absolute;",t.querySelector("#ns-resize-one").style=o+`cursor:ns-resize;margin-left:${t.offsetWidth/2-6}px; margin-top: -7px; position:absolute;`,t.querySelector("#nesw-resize-one").style=o+`cursor:nesw-resize;margin-left:${t.offsetWidth-6}px; margin-top: -6px;position:absolute; `,t.querySelector("#ew-resize-one").style=o+`cursor:ew-resize;margin-left:${t.offsetWidth-7}px; margin-top: ${t.offsetHeight/2-7}px;position:absolute;`,t.querySelector("#nwse-resize-two").style=o+`cursor:nwse-resize;margin-left:${t.offsetWidth-7}px; margin-top: ${t.offsetHeight-7}px;position:absolute; `,t.querySelector("#ns-resize-two").style=o+`cursor:ns-resize;margin-left:${t.offsetWidth/2-6}px; margin-top: ${t.offsetHeight-7}px;position:absolute; `,t.querySelector("#nesw-resize-two").style=o+`cursor:nesw-resize;margin-left:-7px; margin-top:${t.offsetHeight-7}px;position:absolute;`,t.querySelector("#ew-resize-two").style=o+`cursor:ew-resize;margin-left:-6px; margin-top: ${t.offsetHeight/2-6}px; position:absolute;`,t.setAttribute("data-prev-mousepos",`${r.clientX}-${r.clientY}`)}}}getOptimizedImageSize(t,e,r,s){var o=0,a=0,i=0,l=.95,n=.05;if(r>=t&&s>=e)r>=s?r>s?(a=s*((i=r/(r/t)-n*t)/r))>=l*e&&(i=r*((a=s*(o=e/s)-n*e)/s)):t>e?i=a=l*e:e>t?a=i=l*t:i=r*((a=s*(o=e/s)-n*e)/s):i=r*((a=s/(o=s/e)-n*e)/s);else if(r>=t&&s<e)a=s*((i=r*(t/r)-n*t)/r);else if(s>=e&&r<t)a=s*((i=r*((a=s*(o=e/s)-n*e)/s))/r);else{var d=l*t,u=l*e;if(r>=d&&s>=u)p=u/s,i=d*(d/r),a=e*o;else if(r>=d&&s<u)a=s*((i=r*(d/r))/r);else if(s>=u&&r<d){var p=u/s;i=r*((a=s*p)/s)}else i=r,a=s;a=s*(i/r)}return i>l*t&&(a=s*((i=l*t)/r)),{width:i,height:a}}setCanvasCo(t){if(null!=t.target.getAttribute("data-start-co")){let e=t.target.getAttribute("data-start-co").split(","),r=parseInt(e[0]),s=parseInt(e[1]),o=t.offsetX<0?0:t.offsetX,a=t.offsetY<0?0:t.offsetY,i=a>=s?a-s:s-a,l=o>=r?o-r:r-o;return 0!==l&&0!==i?o<r&&a<s?{el:t.target,startX:o,startY:s-i,height:i,width:l}:o>r&&a<s?{el:t.target,startX:r,startY:s-i,height:i,width:l}:o<r&&a>s?{el:t.target,startX:o,startY:a-i,height:i,width:l}:{el:t.target,startX:r,startY:s,height:i,width:l}:void 0}}onKeyStroke(t){let e=document.querySelector("#cropRect");if(null!=e){let r,s,o=document.querySelector("#js-crop-image"),a=e.getAttribute("data-start-xy").split(",");switch(t.code){case"ArrowUp":r=parseInt(a[1])-1,0<=r&&(e.setAttribute("data-start-xy",a[0]+","+r),o.setAttribute("data-start-co",a[0]+","+r),e.style.top=parseInt(e.style.top)-1);break;case"ArrowDown":r=parseInt(a[1])+1,e.offsetHeight+r<=o.offsetHeight&&(e.setAttribute("data-start-xy",a[0]+","+r),o.setAttribute("data-start-co",a[0]+","+r),e.style.top=parseInt(e.style.top)+1);break;case"ArrowLeft":s=parseInt(a[0])-1,0<=s&&(e.setAttribute("data-start-xy",s+","+a[1]),o.setAttribute("data-start-co",s+","+a[1]),e.style.left=parseInt(e.style.left)-1);break;case"ArrowRight":s=parseInt(a[0])+1,e.offsetWidth+s<=o.offsetWidth&&(e.setAttribute("data-start-xy",s+","+a[1]),o.setAttribute("data-start-co",s+","+a[1]),e.style.left=parseInt(e.style.left)+1)}}}}window.addEventListener("DOMContentLoaded",(()=>{let e=document.querySelector("#image-load");var r=new t("#upload-img",{saveButton:!1,customColor:{overlayBgColor:e.style.backgroundColor,toolbarBgColor:e.querySelector("p").style.color,buttonBgColor:e.querySelector("p").style.color,buttonFontColor:e.style.backgroundColor}},[{buttonText:"&#9729;",buttonTitle:"Upload Image",relParam:js_crop_params,callBack:(t,e)=>{var r=new XMLHttpRequest;r.open("POST",e.my_ajax_url,!0),r.responseType="text",r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),r.addEventListener("load",(t=>{t.target.status>=200&&t.target.status,alert(t.target.response)})),r.send("action=process_image&blob="+t)}}]);let s=document.querySelector("#upload-img"),o=document.querySelector("#browse-image"),a=document.querySelector("#image-load");o.addEventListener("click",(()=>s.click())),a.addEventListener("dragover",(t=>t.preventDefault())),a.addEventListener("drop",(t=>{t.preventDefault();let s=t.dataTransfer.files[0];if(FileReader){let t=new FileReader;t.readAsDataURL(s),t.addEventListener("load",(t=>{let s=new Image;s.src=t.target.result,s.addEventListener("load",(t=>r.createOverlay(t.target,{saveButton:!1,customColor:{overlayBgColor:e.style.backgroundColor,toolbarBgColor:e.querySelector("p").style.color,buttonBgColor:e.querySelector("p").style.color,buttonFontColor:e.style.backgroundColor}},[{buttonText:"&#9729;",buttonTitle:"Upload Image",relParam:js_crop_params,callBack:(t,e)=>{var r=new XMLHttpRequest;r.open("POST",e.my_ajax_url,!0),r.responseType="text",r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),r.addEventListener("load",(t=>{t.target.status>=200&&t.target.status,alert(t.target.response)})),r.send("action=process_image&blob="+t)}}])))}))}}))}))})();